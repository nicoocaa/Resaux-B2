# TP2 : Environnement virtuel

## Compte-rendu

☀️ Sur **`node1.lan1.tp2`**

- afficher ses cartes réseau : 
```
[nico@N1L1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:d7:6f:c7 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fed7:6fc7/64 scope link
       valid_lft forever preferred_lft forever
```
- afficher sa table de routage: 
```
[nico@N1L1 ~]$ ip route
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.0/24 via 10.1.1.254 dev enp0s3
```
- prouvez qu'il peut joindre `node2.lan2.tp2`: 
```
[nico@N1L1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=3.83 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=2.28 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=2.40 ms
64 bytes from 10.1.2.12: icmp_seq=4 ttl=63 time=4.12 ms
^C
--- 10.1.2.12 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3007ms
rtt min/avg/max/mdev = 2.277/3.154/4.117/0.825 ms
```
- prouvez avec un `traceroute` que le paquet passe bien par `router.tp2`: 
```
[nico@N1L1 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  10.1.1.254 (10.1.1.254)  1.796 ms  1.841 ms  1.707 ms
 2  10.1.2.12 (10.1.2.12)  3.915 ms !X  4.874 ms !X  3.548 ms !X
```



# II. Interlude accès internet

☀️ **Sur `router.tp2`**

- prouvez que vous avez un accès internet (ping d'une IP publique) : 
```
[nico@router ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=115 time=14.0 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=115 time=15.4 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=115 time=14.4 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=115 time=13.6 ms
^C
--- 8.8.8.8 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3009ms
rtt min/avg/max/mdev = 13.610/14.356/15.354/0.647 ms
```
- prouvez que vous pouvez résoudre des noms publics (ping d'un nom de domaine public) : 
```
[nico@router ~]$ ping youtube.com
PING youtube.com (142.251.220.238) 56(84) bytes of data.
64 bytes from mnl08s01-in-f14.1e100.net (142.251.220.238): icmp_seq=1 ttl=54 time=261 ms
64 bytes from mnl08s01-in-f14.1e100.net (142.251.220.238): icmp_seq=2 ttl=54 time=263 ms
64 bytes from mnl08s01-in-f14.1e100.net (142.251.220.238): icmp_seq=3 ttl=54 time=260 ms
^C
--- youtube.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 259.721/261.129/262.573/1.164 ms
```

☀️ **Accès internet LAN1 et LAN2**

- ajoutez une route par défaut sur les deux machines du LAN1 : 
```
[nico@N1L1 ~]$ sudo ip route add default via 10.1.1.254
[sudo] password for nico:
[nico@N1L1 ~]$
```
```
[nico@N2L1 ~]$ sudo ip route add default via 10.1.1.254
[sudo] password for nico:
[nico@N2L1 ~]$
```
- ajoutez une route par défaut sur les deux machines du LAN2 : 
```
[nico@N1L2 ~]$ sudo ip route add default via 10.1.2.254
[sudo] password for nico:
[nico@N1L2 ~]$
```
```
[nico@N2L2 ~]$ sudo ip route add default via 10.1.2.254
[sudo] password for nico:
[nico@N2L2 ~]$
```
- configurez l'adresse d'un serveur DNS que vos machines peuvent utiliser pour résoudre des noms :

```
[nico@N2L1 ~]$ sudo vi /etc/resolv.conf
[nico@N2L1 ~]$ cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 1.1.1.1
[nico@N2L1 ~]$ 
```
- dans le compte-rendu, mettez-moi que la conf des points précédents sur `node2.lan1.tp2`
- prouvez que `node2.lan1.tp2` a un accès internet :
```
[nico@N2L1 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=114 time=17.2 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=114 time=18.4 ms
^C
--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 17.181/17.781/18.382/0.600 ms
[nico@N2L1 ~]$ ping youtube.com
PING youtube.com (142.250.179.78) 56(84) bytes of data.
64 bytes from par21s19-in-f14.1e100.net (142.250.179.78): icmp_seq=1 ttl=115 time=14.3 ms
64 bytes from par21s19-in-f14.1e100.net (142.250.179.78): icmp_seq=2 ttl=115 time=15.0 ms
64 bytes from par21s19-in-f14.1e100.net (142.250.179.78): icmp_seq=3 ttl=115 time=14.9 ms
^C
--- youtube.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 14.337/14.745/15.011/0.293 ms

```

# III. Services réseau


## 1. Web web web


☀️ **Sur `web.lan2.tp2`**

```
[nico@Web ~]$ sudo dnf install nginx -y
[sudo] password for nico:
AlmaLinux 9 - AppStream                                               7.0 kB/s | 4.2 kB     00:00
AlmaLinux 9 - AppStream                                               1.8 MB/s |  14 MB     00:08
AlmaLinux 9 - BaseOS                                                  7.1 kB/s | 3.8 kB     00:00
AlmaLinux 9 - BaseOS                                                  2.3 MB/s |  15 MB     00:06
AlmaLinux 9 - Extras                                                  5.9 kB/s | 3.3 kB     00:00
AlmaLinux 9 - Extras                                                   31 kB/s |  20 kB     00:00
Last metadata expiration check: 0:00:01 ago on Fri Oct  4 16:41:00 2024.
Dependencies resolved.
======================================================================================================
 Package                        Architecture    Version                      Repository          Size
======================================================================================================
Installing:
 nginx                          x86_64          1:1.20.1-16.el9_4.1          appstream           35 k
Installing dependencies:
 almalinux-logos-httpd          noarch          90.5.1-1.1.el9               appstream           18 k
 nginx-core                     x86_64          1:1.20.1-16.el9_4.1          appstream          565 k
 nginx-filesystem               noarch          1:1.20.1-16.el9_4.1          appstream          7.9 k

Transaction Summary
======================================================================================================
Install  4 Packages

Total download size: 626 k
Installed size: 1.8 M
Downloading Packages:
(1/4): almalinux-logos-httpd-90.5.1-1.1.el9.noarch.rpm                155 kB/s |  18 kB     00:00
(2/4): nginx-1.20.1-16.el9_4.1.x86_64.rpm                             259 kB/s |  35 kB     00:00
(3/4): nginx-filesystem-1.20.1-16.el9_4.1.noarch.rpm                  102 kB/s | 7.9 kB     00:00
(4/4): nginx-core-1.20.1-16.el9_4.1.x86_64.rpm                        1.3 MB/s | 565 kB     00:00
------------------------------------------------------------------------------------------------------
Total                                                                 730 kB/s | 626 kB     00:00
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                                              1/1
  Running scriptlet: nginx-filesystem-1:1.20.1-16.el9_4.1.noarch                                  1/4
  Installing       : nginx-filesystem-1:1.20.1-16.el9_4.1.noarch                                  1/4
  Installing       : nginx-core-1:1.20.1-16.el9_4.1.x86_64                                        2/4
  Installing       : almalinux-logos-httpd-90.5.1-1.1.el9.noarch                                  3/4
  Installing       : nginx-1:1.20.1-16.el9_4.1.x86_64                                             4/4
  Running scriptlet: nginx-1:1.20.1-16.el9_4.1.x86_64                                             4/4
  Verifying        : almalinux-logos-httpd-90.5.1-1.1.el9.noarch                                  1/4
  Verifying        : nginx-1:1.20.1-16.el9_4.1.x86_64                                             2/4
  Verifying        : nginx-core-1:1.20.1-16.el9_4.1.x86_64                                        3/4
  Verifying        : nginx-filesystem-1:1.20.1-16.el9_4.1.noarch                                  4/4

Installed:
  almalinux-logos-httpd-90.5.1-1.1.el9.noarch       nginx-1:1.20.1-16.el9_4.1.x86_64
  nginx-core-1:1.20.1-16.el9_4.1.x86_64             nginx-filesystem-1:1.20.1-16.el9_4.1.noarch

Complete!
[nico@Web ~]$ sudo mkdir -p /var/www/site_nul/
[nico@Web ~]$ sudo chown -R nginx:nginx /var/www/site_nul/
[nico@Web ~]$ sudo chmod -R 755 /var/www/site_nul/
[nico@Web ~]$ sudo vi /var/www/site_nul/index.html
[nico@Web ~]$ cat /var/www/site_nul/index.html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Nul</title>
</head>
<body>
    <h1>Bienvenue sur Mon site</h1>
    <a href="youtube.com"> lien vers ytb !!!! </a>
</body>
</html>

[nico@Web ~]$ sudo vi /etc/nginx/conf.d/site_nul.conf
[sudo] password for nico:
[nico@Web ~]$ cat /etc/nginx/conf.d/site_nul.conf
server {
    listen 80;
    server_name site_nul.tp2;

    location / {
        root /var/www/site_nul;
        index index.html;
    }
}

[nico@Web ~]$ sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
[nico@Web ~]$ sudo systemctl start nginx
[nico@Web ~]$ sudo systemctl enable nginx
Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.
[nico@Web ~]$ sudo firewall-cmd --add-service=http --permanent
success
[nico@Web ~]$ sudo firewall-cmd --reload
success
[nico@Web ~]$ ss -tuln | grep :80
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*
tcp   LISTEN 0      511             [::]:80           [::]:*
[nico@Web ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources:
  services: cockpit dhcpv6-client http ssh
  ports:
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
[nico@Web ~]$
```

☀️ **Sur `node1.lan1.tp2`**

- éditez le fichier `hosts` pour que `site_nul.tp2` pointe vers l'IP de `web.lan2.tp2`: 
```
[nico@N1L1 ~]$ sudo vi /etc/hosts
[sudo] password for nico:
[nico@N1L1 ~]$ cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12   site_nul.tp2
[nico@N1L1 ~]$
```
- visitez le site nul avec une commande `curl` et en utilisant le nom `site_nul.tp2`: 
```
[nico@N1L1 ~]$ curl http://site_nul.tp2
<html>
<head><title>403 Forbidden</title></head>
<body>
<center><h1>403 Forbidden</h1></center>
<hr><center>nginx/1.20.1</center>
</body>
</html>
[nico@N1L1 ~]$
```
